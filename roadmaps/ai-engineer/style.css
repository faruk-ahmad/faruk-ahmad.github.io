:root{
  --bg: #f6f8fb;
  --surface: #ffffff;
  --ink: #0f172a;
  --muted: #475569;
  --border: #e5e7eb;
  --primary: #2563eb;
  --primary-dark: #1d4ed8;
  --accent: #22c55e;
  --warn: #f59e0b;
  --danger: #ef4444;
  --shadow-1: 0 1px 2px rgba(2,6,23,.06), 0 1px 3px rgba(2,6,23,.08);
  --shadow-2: 0 8px 24px rgba(2,6,23,.10), 0 3px 8px rgba(2,6,23,.08);
  --radius: 16px;
  --header-h: 64px;
  --footer-h: 56px;
  --sidebar-w: 300px;
}

/* Dark theme */
[data-theme="dark"]{
  --bg: #0b1220;
  --surface: #0f172a;
  --ink: #e5e7eb;
  --muted: #94a3b8;
  --border: #1f2937;
  --primary: #60a5fa;
  --primary-dark: #3b82f6;
  --accent: #34d399;
  --warn: #fbbf24;
}

*{box-sizing:border-box}
html,body{height:100%}
body{margin:0; background: var(--bg); color:var(--ink); font: 16px/1.6 Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial}

/* Fixed Header */
header{position:fixed; inset:0 0 auto 0; height:var(--header-h); z-index:100; background:var(--surface); box-shadow: var(--shadow-1); border-bottom:1px solid var(--border)}
.topbar{max-width:1200px; margin:0 auto; height:100%; padding:0 18px; display:flex; align-items:center; gap:16px; justify-content:space-between}
.brand{display:flex; align-items:center; gap:12px}
.logo{width:36px; height:36px; border-radius:10px; display:grid; place-items:center; background: linear-gradient(135deg, var(--primary), #60a5fa); color:white; box-shadow: var(--shadow-2); font-weight:700}
h1{margin:0; font-size: clamp(18px, 2.2vw, 22px); letter-spacing:.2px}
.top-actions{display:flex; align-items:center; gap:10px}
.btn{display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:12px; border:1px solid var(--border); background:#f8fafc; color:inherit; cursor:pointer}
[data-theme="dark"] .btn{background:#0b1220}

/* Fixed Footer */
footer.site{position:fixed; inset:auto 0 0 0; height:var(--footer-h); background:var(--surface); border-top:1px solid var(--border); display:flex; align-items:center; justify-content:center; padding:0 16px; z-index:90}
footer.site .inner{max-width:1200px; width:100%; display:flex; align-items:center; justify-content:space-between; color:var(--muted); font-size:14px}
footer.site a{color:var(--primary); text-decoration:none}

/* KPI chip in header */
.kpi{border-radius:14px; padding:6px 10px; background:#f1f5f9; border:1px solid var(--border); text-align:center; display:flex; align-items:center; gap:10px}
[data-theme="dark"] .kpi{background:#0b1220}
.progressbar{height:10px; background:#e5e7eb; border-radius:999px; overflow:hidden; width:160px}
.progressbar>div{height:100%; width:0; background:linear-gradient(90deg, var(--primary), var(--accent))}

/* Layout */
.page{display:grid; grid-template-columns: var(--sidebar-w) 1fr; gap:22px; max-width:1200px; margin:calc(var(--header-h) + 14px) auto calc(var(--footer-h) + 14px); padding:0 22px}

/* Sidebar */
aside{position:sticky; top:calc(var(--header-h) + 12px); align-self:start; height: calc(100vh - var(--header-h) - 24px - var(--footer-h)); overflow:auto; background:var(--surface); border:1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow-1)}
.side-head{padding:12px 16px; border-bottom:1px solid var(--border); font-weight:700; display:flex; align-items:center; justify-content:space-between}
.nav{display:flex; flex-direction:column; padding:8px}
.nav a{padding:8px 12px; border-radius:12px; color: var(--muted); text-decoration:none; display:flex; align-items:center; gap:8px; transition: .15s}
.nav a .num{font-variant-numeric: tabular-nums; color:#1f2937; font-weight:600; width:48px}
[data-theme="dark"] .nav a .num{color:#cbd5e1}
.nav a:hover{background:#eff6ff; color:var(--primary)}
[data-theme="dark"] .nav a:hover{background:#111827}
.nav a.active{background:#e0e7ff; color:#111827}
[data-theme="dark"] .nav a.active{background:#0b1220; color:#cbd5e1}
.nav .sub{padding-left:20px}

/* Mobile Sidebar (drawer) */
.drawer-toggle{display:none}
@media (max-width: 980px){
  .page{grid-template-columns: 1fr}
  aside{position:fixed; left:0; top:var(--header-h); width:min(92%, 360px); transform:translateX(-110%); height: calc(100vh - var(--header-h) - var(--footer-h)); border-right:1px solid var(--border); transition:.25s; z-index:95}
  .drawer-toggle{display:inline-flex}
  body.drawer-open aside{transform:translateX(0)}
  body.drawer-open .overlay{opacity:.35; pointer-events:auto}
  .overlay{position:fixed; inset:var(--header-h) 0 var(--footer-h) 0; background:#000; opacity:0; pointer-events:none; transition:.25s; z-index:90}
}

/* Content */
main{min-width:0}
.hero{background:var(--surface); border:1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow-1); padding:18px}
.hero p{color:var(--muted); margin-top:6px}
.kpis{display:grid; grid-template-columns: repeat(4,1fr); gap:12px; margin-top:12px}

section{scroll-margin-top:calc(var(--header-h) + 12px)}
.stage{margin: 26px 0 34px}
.title-row{display:flex; align-items:center; gap:10px; justify-content:space-between}
.stage h2{font-size: clamp(24px, 2.6vw, 34px); margin:0 0 10px}
.stage h2 .badge{font-size:14px; color:#fff; background:var(--primary); border-radius:999px; padding:4px 10px; margin-left:8px}
.share,.collapse{display:inline-flex; align-items:center; gap:6px; font-size:13px; border:1px solid var(--border); border-radius:10px; padding:6px 10px; background:#f8fafc; cursor:pointer}

.grid{display:grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap:16px}

/* Topic Card */
.card{background: var(--surface); border:1px solid var(--border); border-radius: var(--radius); padding:16px; box-shadow: var(--shadow-1); display:flex; flex-direction:column; gap:10px}
.card:hover{box-shadow: var(--shadow-2)}
.topic-head{display:flex; align-items:flex-start; justify-content:space-between; gap:12px}
.topic-title{margin:0; font-size:18px}
.topic-title small{color:var(--muted); font-weight:500}
.topic-anchors{display:flex; gap:8px; align-items:center}
.anchor-btn,.done-btn{border:1px solid var(--border); background:#eff6ff; color:#1e3a8a; border-radius:8px; padding:6px 8px; cursor:pointer; font-size:12px}
.done-btn{background:#ecfdf5; color:#065f46}

.meta{display:flex; flex-wrap:wrap; gap:8px}
.chip{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; background:#eef2ff; border:1px solid #e0e7ff; color:#3730a3; font-size: 12px}
.chip.warn{background:#fffbeb; border-color:#fef3c7; color:#92400e}
.chip.ok{background:#ecfdf5; border-color:#bbf7d0; color:#065f46}
.chip.book{background:#fff7ed; border-color:#fed7aa; color:#9a3412}

.guides{display:grid; grid-template-columns: 1fr; gap:8px}
.guide{border:1px dashed var(--border); border-radius:12px; padding:10px 12px; background:#fbfdff}
.guide h4{margin:0 0 6px; font-size:14px}
.guide ul{margin:0; padding-left:18px}
.guide li{margin:4px 0}

.links{display:flex; flex-wrap:wrap; gap:8px; margin-top:4px}
.link{display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:999px; background:#eff6ff; border:1px solid #dbeafe; text-decoration:none; color:#1e3a8a; font-size: 14px}
.link.tutorial{background:#ecfdf5; border-color:#bbf7d0; color:#065f46}

/* Details panels */
details{border:1px dashed var(--border); border-radius:12px; overflow:hidden}
summary{cursor:pointer; padding:12px 14px; background:#f8fafc}
.panel{padding: 12px 14px; background:#fbfdff}

/* Print */
@media print{
  header, footer.site, .drawer-toggle, .share, .collapse, .anchor-btn, .done-btn{display:none !important}
  body{background:#fff}
  .page{margin:0; max-width:100%; padding:0}
  aside{position:static; border:none; box-shadow:none}
}
