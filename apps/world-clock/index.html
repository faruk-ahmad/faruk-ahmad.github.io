<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>World Clock On the Go!</title>
<style>
  :root{
    --bg:#0b0f14; --panel:#0f172a; --text:#e6edf3; --muted:#9aa3b2; --ring:#1f2937;
    --accent:#22d3ee; --good:#10b981; --bad:#ef4444;
  }
  @media (prefers-color-scheme: light){
    :root{ --bg:#f6f8fb; --panel:#ffffff; --text:#0b1220; --muted:#6b7280; --ring:#e5e7eb;
           --accent:#0ea5e9; --good:#059669; --bad:#dc2626; }
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; padding:22px; font:15px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans";
    color:var(--text);
    background:
      radial-gradient(1100px 500px at -10% -10%, color-mix(in srgb, var(--accent) 18%, transparent), transparent 60%),
      radial-gradient(900px 400px at 110% 0%, color-mix(in srgb, var(--good) 14%, transparent), transparent 60%),
      var(--bg);
  }
  h1{ text-align:center; margin:0 0 16px; font-size:20px }

  .controls{ display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin-bottom:14px }
  .chip{
    display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px;
    background:var(--panel); border:1px solid var(--ring); box-shadow:0 0 0 1px color-mix(in srgb, var(--ring) 40%, transparent) inset;
  }
  select,input[type="checkbox"]{ accent-color:var(--accent) }

  .grid{ display:grid; gap:16px; grid-template-columns:repeat(3,minmax(0,1fr)); }
  @media (max-width:1024px){ .grid{ grid-template-columns:repeat(2,minmax(0,1fr)); } }
  @media (max-width:640px){  .grid{ grid-template-columns:repeat(1,minmax(0,1fr)); } }

  .card{
    position:relative; overflow:hidden; border-radius:18px; padding:18px 18px 16px;
    background:linear-gradient(180deg, color-mix(in srgb, var(--panel) 92%, transparent), var(--panel));
    border:1px solid color-mix(in srgb, var(--ring) 80%, transparent);
    box-shadow:0 12px 28px rgba(0,0,0,.18), 0 0 0 1px color-mix(in srgb, var(--ring) 35%, transparent) inset;
    transition:transform .15s ease, box-shadow .2s ease, border-color .2s ease;
    cursor:grab;
    display:grid; grid-template-columns: 1fr auto; column-gap:18px; align-items:center;
    min-height:150px;
  }
  .card:hover{
    transform:translateY(-2px);
    border-color: color-mix(in srgb, var(--accent) 45%, var(--ring));
    box-shadow:0 18px 38px rgba(0,0,0,.22), 0 0 0 1px var(--accent) inset;
  }
  .card.dragging{ opacity:.6 }
  .close{
    position:absolute; top:10px; right:10px; width:26px; height:26px; border-radius:10px;
    display:grid; place-items:center; border:1px solid var(--ring); background:transparent;
    color:var(--muted); cursor:pointer; font-size:14px; line-height:1;
  }
  .close:hover{ color:var(--text); border-color:var(--accent) }

  .left .title{ font-weight:800; font-size:16px; margin:0 0 6px }
  .left .tz{ color:var(--muted); font-size:12px; margin-bottom:8px }
  .left .clockline{ display:flex; align-items:baseline; gap:10px }
  .left .time{ font-variant-numeric:tabular-nums; font-size:34px; font-weight:800; letter-spacing:.3px;
               text-shadow:0 0 14px color-mix(in srgb, var(--accent) 24%, transparent); }
  .left .ampm{ font-size:12px; color:var(--muted) }
  .left .date{ margin-top:8px; color:var(--muted); font-size:13px }
  .left .badge{
    display:inline-block; margin-top:8px; padding:6px 10px; border-radius:999px; font-size:12px;
    border:1px solid var(--ring); background: color-mix(in srgb, var(--panel) 86%, transparent); color:var(--text)
  }
  .left .badge.good{ background: color-mix(in srgb, var(--good) 30%, transparent); border-color: color-mix(in srgb, var(--good) 55%, var(--ring)); color: var(--good) }
  .left .badge.bad{  background: color-mix(in srgb, var(--bad)  25%, transparent); border-color: color-mix(in srgb, var(--bad)  55%, var(--ring)); color: var(--bad)  }
  .left .badge.same{ background: color-mix(in srgb, var(--accent) 25%, transparent); border-color: color-mix(in srgb, var(--accent) 60%, var(--ring)); color: var(--accent) }

  .dial{
    width:110px; height:110px; border-radius:12px; padding:10px;
    background:radial-gradient(120px 60px at 30% 20%, color-mix(in srgb, var(--accent) 18%, transparent), transparent);
    border:1px solid color-mix(in srgb, var(--ring) 70%, transparent);
    box-shadow: inset 0 0 0 1px color-mix(in srgb, var(--ring) 30%, transparent);
  }
  .dial svg{ width:100%; height:100%; display:block }
  .tick { stroke: color-mix(in srgb, var(--muted) 80%, transparent); stroke-width:1 }
  .hand { stroke: var(--text); stroke-linecap:round }
  .hand.h { stroke-width:3.5 }
  .hand.m { stroke-width:2.5 }
  .hand.s { stroke-width:1.3; stroke: var(--accent) }

  /* Footer */
  footer{
    margin-top:18px; text-align:center; font-size:12px; color:var(--muted);
    border-top:1px solid color-mix(in srgb, var(--ring) 70%, transparent);
    padding-top:10px;
  }
</style>
</head>
<body>
  <h1>🌍 World Clock</h1>

  <div class="controls">
    <span class="chip" title="Add a clock quickly">
      <label for="addClock">Add:</label>
      <select id="addClock">
        <option value="">— Select —</option>
        <!-- South Asia -->
        <option value='{"title":"Bangladesh Time","tz":"Asia/Dhaka"}'>🇧🇩 Bangladesh</option>
        <option value='{"title":"India Time","tz":"Asia/Kolkata"}'>🇮🇳 India</option>
        <option value='{"title":"Pakistan Time","tz":"Asia/Karachi"}'>🇵🇰 Pakistan</option>
        <option value='{"title":"Nepal Time","tz":"Asia/Kathmandu"}'>🇳🇵 Nepal</option>
        <option value='{"title":"Sri Lanka Time","tz":"Asia/Colombo"}'>🇱🇰 Sri Lanka</option>
        <!-- East Asia -->
        <option value='{"title":"Japan Time","tz":"Asia/Tokyo"}'>🇯🇵 Japan</option>
        <option value='{"title":"China Time","tz":"Asia/Shanghai"}'>🇨🇳 China</option>
        <option value='{"title":"Singapore Time","tz":"Asia/Singapore"}'>🇸🇬 Singapore</option>
        <!-- Europe -->
        <option value='{"title":"UK Time","tz":"Europe/London"}'>🇬🇧 United Kingdom</option>
        <option value='{"title":"Germany Time","tz":"Europe/Berlin"}'>🇩🇪 Germany</option>
        <option value='{"title":"France Time","tz":"Europe/Paris"}'>🇫🇷 France</option>
        <option value='{"title":"Netherlands Time","tz":"Europe/Amsterdam"}'>🇳🇱 Netherlands</option>
        <!-- Americas -->
        <option value='{"title":"New York Time","tz":"America/New_York"}'>🇺🇸 New York</option>
        <option value='{"title":"Los Angeles Time","tz":"America/Los_Angeles"}'>🇺🇸 Los Angeles</option>
        <option value='{"title":"Chicago Time","tz":"America/Chicago"}'>🇺🇸 Chicago</option>
        <option value='{"title":"São Paulo Time","tz":"America/Sao_Paulo"}'>🇧🇷 São Paulo</option>
      </select>
    </span>

    <span class="chip" title="Compare badges use this base">
      <label for="compareSel">Compare:</label>
      <select id="compareSel"></select>
    </span>

    <span class="chip" title="Switch clock format">
      <input type="checkbox" id="fmt24" />
      <label for="fmt24">24-hour</label>
    </span>

    <span class="chip" title="Show seconds">
      <input type="checkbox" id="showSec" checked />
      <label for="showSec">Seconds</label>
    </span>
  </div>

  <div class="grid" id="grid"></div>

  <footer>by <strong><a href="https://faruk.me" target="_blank">Faruk Ahmad</a></strong> — built with ❤️</footer>

<script>
const STORAGE_KEY = "worldclock.clocks.final.v1";
let clocks = loadClocks() ?? [
  { title: "Bangladesh Time", tz: "Asia/Dhaka" },
  { title: "Japan Time",      tz: "Asia/Tokyo" },
  { title: "UK Time",         tz: "Europe/London" },
  { title: "New York Time",   tz: "America/New_York" }
];

function loadClocks(){
  try{ const raw = localStorage.getItem(STORAGE_KEY); return raw ? JSON.parse(raw) : null; }catch{ return null; }
}
function saveClocks(){
  try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(clocks)); }catch{}
}

const grid = document.getElementById("grid");
const addClock = document.getElementById("addClock");
const compareSel = document.getElementById("compareSel");
const fmt24 = document.getElementById("fmt24");
const showSec = document.getElementById("showSec");

/* ===== TZ helpers (DST & half-hour zones safe) ===== */
function getOffsetMinutes(tz){
  const now = new Date();
  try{
    const parts = new Intl.DateTimeFormat(undefined,{ timeZone:tz, timeZoneName:"shortOffset", hour:"2-digit" }).formatToParts(now);
    const name = parts.find(p=>p.type==="timeZoneName")?.value || "";
    const m = name.match(/([+-])(\d{1,2})(?::?(\d{2}))?/);
    if(m){ const sign = m[1]==="-"?-1:1; const h=+m[2]; const mm=+(m[3]||0); return sign*(h*60+mm); }
  }catch{}
  const [hh,mm] = new Intl.DateTimeFormat("en-GB",{timeZone:tz,hour:"2-digit",minute:"2-digit",hour12:false}).format(now).split(":").map(Number);
  const utcM = now.getUTCHours()*60 + now.getUTCMinutes();
  let guess = (hh*60+mm) - utcM; while(guess<=-720) guess+=1440; while(guess>840) guess-=1440; return guess;
}
const localOffset = () => -new Date().getTimezoneOffset();
function zoneWallDate(tz){ const delta = getOffsetMinutes(tz) - localOffset(); return new Date(Date.now() + delta*60000); }
function formatTimeDate(tz){
  const use24 = fmt24.checked; const sec = showSec.checked ? "2-digit" : undefined; const now = new Date();
  const parts = new Intl.DateTimeFormat(undefined,{timeZone:tz,hour:"2-digit",minute:"2-digit",second:sec,hour12:!use24})
                .formatToParts(now).reduce((a,p)=>(a[p.type]=p.value,a),{});
  const dateStr = new Intl.DateTimeFormat(undefined,{timeZone:tz,weekday:"short",year:"numeric",month:"short",day:"numeric"}).format(now);
  return { time:`${parts.hour}:${parts.minute}${parts.second? ":"+parts.second:""}`, ampm:(!use24&&parts.dayPeriod)?parts.dayPeriod.toUpperCase():"", date:dateStr };
}
function baseOffset(){
  const val = compareSel.value || "__local__";
  if(val==="__local__") return localOffset();
  const obj = clocks.find((_, i)=> String(i)===val);
  return obj ? getOffsetMinutes(obj.tz) : localOffset();
}
function formatDelta(mins){
  const sign=Math.sign(mins), abs=Math.abs(mins), h=Math.floor(abs/60), m=abs%60;
  if(sign===0) return { text:"same as base", cls:"badge same" };
  return { text:`${sign>0?"+":"-"}${h}h${m? " "+m+"m":""} ${sign>0?"ahead":"behind"}`, cls:"badge "+(sign>0?"good":"bad") };
}

/* ===== Render ===== */
function render(){
  compareSel.innerHTML = `<option value="__local__">Local Time</option>` + clocks.map((c,i)=>`<option value="${i}">${c.title}</option>`).join("");
  grid.innerHTML = "";
  clocks.forEach((cfg, idx)=>{
    const card = document.createElement("article");
    card.className = "card"; card.draggable = true;
    card.dataset.tz = cfg.tz; card.dataset.title = cfg.title;

    const left = document.createElement("div");
    left.className = "left";
    left.innerHTML = `
      <div class="title">${cfg.title}</div>
      <div class="tz">${cfg.tz}</div>
      <div class="clockline"><span class="time" id="time-${idx}"></span><span class="ampm" id="ampm-${idx}"></span></div>
      <div class="date" id="date-${idx}"></div>
      <div class="badge" id="badge-${idx}"></div>`;

    const right = document.createElement("div");
    right.className = "dial";
    right.innerHTML = `
      <svg viewBox="0 0 100 100" aria-hidden="true">
        <circle cx="50" cy="50" r="46" fill="none" stroke="rgba(255,255,255,.08)" stroke-width="1"/>
        ${Array.from({length:12}).map((_,i)=>{const a=(i/12)*2*Math.PI,x1=50+Math.sin(a)*40,y1=50-Math.cos(a)*40,x2=50+Math.sin(a)*46,y2=50-Math.cos(a)*46;return `<line class="tick" x1="${x1.toFixed(2)}" y1="${y1.toFixed(2)}" x2="${x2.toFixed(2)}" y2="${y2.toFixed(2)}"/>`;}).join("")}
        <line id="h-${idx}" class="hand h" x1="50" y1="50" x2="50" y2="32" />
        <line id="m-${idx}" class="hand m" x1="50" y1="50" x2="50" y2="22" />
        <line id="s-${idx}" class="hand s" x1="50" y1="50" x2="50" y2="18" />
        <circle cx="50" cy="50" r="2.4" fill="var(--text)"/>
      </svg>`;

    const close = document.createElement("button");
    close.className = "close"; close.title="Remove"; close.textContent="✕";
    close.onclick = (e)=>{ e.stopPropagation(); clocks = clocks.filter(c => !(c.tz===cfg.tz && c.title===cfg.title)); saveClocks(); render(); };

    card.append(left,right,close); grid.appendChild(card);

    card.addEventListener("dragstart", ()=> card.classList.add("dragging"));
    card.addEventListener("dragend", ()=>{ card.classList.remove("dragging"); persistOrderFromDOM(); });

    card._tick = ()=> updateCard(idx, cfg.tz);
  });
  tickAll();
}
function updateCard(idx, tz){
  const {time, ampm, date} = formatTimeDate(tz);
  const tEl=document.getElementById(`time-${idx}`), aEl=document.getElementById(`ampm-${idx}`), dEl=document.getElementById(`date-${idx}`);
  if(tEl) tEl.textContent=time; if(aEl) aEl.textContent=ampm? " "+ampm:""; if(dEl) dEl.textContent=date;

  const delta = getOffsetMinutes(tz) - baseOffset();
  const b=document.getElementById(`badge-${idx}`); if(b){ const f=formatDelta(delta); b.textContent=f.text; b.className=f.cls; }

  const z=zoneWallDate(tz), s=z.getSeconds(), m=z.getMinutes(), h=z.getHours()%12;
  const sA=s*6, mA=(m+s/60)*6, hA=(h+m/60)*30;
  const H=document.getElementById(`h-${idx}`), M=document.getElementById(`m-${idx}`), S=document.getElementById(`s-${idx}`);
  if(H) H.setAttribute("transform",`rotate(${hA} 50 50)`); if(M) M.setAttribute("transform",`rotate(${mA} 50 50)`); if(S) S.setAttribute("transform",`rotate(${sA} 50 50)`);
}

/* ===== Timer ===== */
function tickAll(){
  document.querySelectorAll(".card").forEach(c=>c._tick && c._tick());
  const now=Date.now(), delay=1000-(now%1000)+5; setTimeout(tickAll, delay);
}

/* ===== Drag reorder ===== */
grid.addEventListener("dragover", e=>{
  e.preventDefault();
  const dragging=document.querySelector(".dragging"); if(!dragging) return;
  const cards=[...grid.querySelectorAll(".card:not(.dragging)")];
  const next=cards.find(el=> e.clientY <= el.getBoundingClientRect().top + el.offsetHeight/2);
  grid.insertBefore(dragging, next || null);
});
function persistOrderFromDOM(){
  const order=[...grid.querySelectorAll(".card")].map(c=>({title:c.dataset.title, tz:c.dataset.tz}));
  const next=[]; order.forEach(o=>{ const f=clocks.find(c=>c.title===o.title && c.tz===o.tz); if(f) next.push(f); });
  clocks=next; saveClocks(); render();
}

/* ===== Controls ===== */
addClock.addEventListener("change", e=>{
  if(!e.target.value) return;
  const cfg=JSON.parse(e.target.value);
  if(!clocks.some(c=>c.tz===cfg.tz && c.title===cfg.title)){ clocks.push(cfg); saveClocks(); render(); }
  e.target.value="";
});
compareSel.addEventListener("change", tickAll);
fmt24.addEventListener("change", tickAll);
showSec.addEventListener("change", tickAll);

/* Init */
render();
</script>
</body>
</html>
